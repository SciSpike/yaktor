#!/usr/bin/env bash

if [ ! -f ~/.npmrc ]; then
  touch ~/.npmrc
fi


if [ -z "$APP_NAME" ]; then
  export APP_NAME=${PWD##*/} # (basename of the current directory)
fi

. $(dirname $0)/yak-up -d

export YAKTOR_DOCKER_MACHINE=${YAKTOR_DOCKER_MACHINE-default}

if [ "$(uname)" == "Darwin" ]; then
  ./osx-route.sh
fi

if [ "$#" -eq 0 ]; then
  CMD=help
else
  CMD="$@"
fi
if [ ! "$CMD" == 'bash' ]; then
  if [[ ! "$CMD" =~ ^yaktor ]]; then
    CMD="grunt $CMD"
  fi
else
  CMD="bash -l"
fi

docker exec -it ${APP_NAME}-app bash -c ". ~/.profile && $CMD"
